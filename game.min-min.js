"use strict";function Boid(t){GameObject(this),this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.radius=6,this.speed=2,this.radialSpeed=Math.PI/60,this.vision=50,this.heading=2*Math.random()*Math.PI-Math.PI}function Swarm(t){GameObject(this),this.ctx=t,this.boids=[];var e=this;this.animate=function(){Swarm.step(e)},this.padding=8}function entity(t){}function GameObject(t){document.addEventListener("DOMContentLoaded",function(){document.addEventListener("mousedown",function(e){t.triggerListeners("mousedown",e)},!1),document.addEventListener("mouseup",function(e){t.triggerListeners("mouseup",e)},!1),document.addEventListener("mousemove",function(e){t.triggerListeners("mousemove",e)},!1),document.addEventListener("touchstart",function(e){t.triggerListeners("touchstart",e)},!1),document.addEventListener("touchend",function(e){t.triggerListeners("touchend",e)},!1),document.addEventListener("touchmove",function(e){t.triggerListeners("touchmove",e)},!1)})}function Game(t){function e(){var t=Date.now();o=(t-n)/1e3,a.ctx.beginPath(),a.ctx.rect(0,0,a.width,a.height),a.ctx.fillStyle="black",a.ctx.fill(),a.ctx.globalAlpha=1,a.update(o),a.render(),n=t,window.requestAnimFrame(e)}function i(t,e){a.eventListeners.forEach(function(i){i.type===t&&i.callback(e)})}GameObject(this),this.canvas=null,this.scenes=[],this.keys=[],this.events=[],this.touch=!1,this.width=t.width||640,this.height=t.height||480,this.messages=[],this.activeScene=-1,this.eventListeners=[];var n=Date.now(),o=0,a=this;this.addScene=function(t){t.parent=this,this.scenes.push(t)},this.addEventListener=function(t,e){this.eventListeners.push({type:t,callback:e})},document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),window.addEventListener("load",function(){window.scrollTo(0,1)}),this.init=function(t,i){this.canvas=document.getElementById(t),this.canvas.width=this.width=window.innerWidth,this.canvas.height=this.height=window.innerHeight,this.ctx=this.canvas.getContext("2d"),this.webgl=document.getElementById(i),this.webgl.width=this.width=window.innerWidth,this.webgl.height=this.height=window.innerHeight,this.gl=this.webgl.getContext("webgl")||this.webgl.getContext("experimental-webgl"),this.gl.viewport(0,0,this.webgl.width,this.webgl.height),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);var o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),this.gl.STATIC_DRAW),this.addListener("update",function(t){a.activeScene>=0&&a.scenes[a.activeScene].update(t)}),this.addListener("render",function(t){a.activeScene>=0&&a.scenes[a.activeScene].render()}),n=Date.now(),e()},window.addEventListener("resize",function(){a.canvas.width=window.innerWidth,a.canvas.height=window.innerHeight},!1),document.addEventListener("keydown",function(t){a.keys[t.keyCode]=!0,i("keydown",t)},!1),document.addEventListener("keyup",function(t){a.keys[t.keyCode]=!1,i("keyup",t)},!1),document.addEventListener("touchstart",function(t){a.touch=!0,i("touchstart",t)},!1),document.addEventListener("touchend",function(t){a.touch=!1,i("touchend",t)},!1),document.addEventListener("mousedown",function(t){a.mouseEvent=t,a.touch=!0,i("mousedown",t)},!1),document.addEventListener("mouseup",function(t){a.mouseEvent=t,a.touch=!1,i("mouseup",t)},!1),document.addEventListener("mousemove",function(t){i("mousemove",t)},!1)}function Glitch(){GameObject(this),this.position={x:0,y:0},this.dimension={w:16,h:16},this.distance={x:10*Math.random()-5,y:10*Math.random()-5},this.velocity=5*Math.random()+5,this.rotateTo=0,this.angle=0,this.timer=0;var t=this;this.addListener("update",function(e){t.collisionTests&&t.collisionTests.forEach(function(e){if("player"===e.type){var i={x:e.target.position.x,y:e.target.position.y,width:e.target.dimension.w,height:e.target.dimension.h},n={x:t.position.x,y:t.position.y,width:t.dimension.w,height:t.dimension.h};i.x<n.x+n.width&&i.x+i.width>n.x&&i.y<n.y+n.height&&i.height+i.y>n.y&&(e.collision=!0,e.callback(t,e))}if("explosion"===e.type){var o={x:e.target.position.x,y:e.target.position.y,r:e.target.bubble.w},a={x:t.position.x,y:t.position.y,w:t.dimension.w,h:t.dimension.h},r=Math.abs(o.x-a.x-a.w/2),s=Math.abs(o.y-a.y-a.h/2);if(r>a.w/2+o.r)return!1;if(s>a.h/2+o.r)return!1;r<=a.w/2&&(e.collision=!0),s<=a.h/2&&(e.collision=!0);var h=r-a.w/2,l=s-a.h/2;e.collision=h*h+l*l<=o.r*o.r,e.collision&&e.callback(t,e)}if("emp"===e.type){var o={x:e.target.position.x,y:e.target.position.y,r:e.target.bubble.w},a={x:t.position.x,y:t.position.y,w:t.dimension.w,h:t.dimension.h},r=Math.abs(o.x-a.x-a.w/2),s=Math.abs(o.y-a.y-a.h/2);if(r>a.w/2+o.r)return!1;if(s>a.h/2+o.r)return!1;r<=a.w/2&&(e.collision=!0),s<=a.h/2&&(e.collision=!0);var h=r-a.w/2,l=s-a.h/2;e.collision=h*h+l*l<=o.r*o.r,e.collision&&e.callback(t,e)}}),t.timer+=e*t.velocity,parseInt(t.timer)%25===0&&parseInt(t.timer)%50!=0&&(t.distance.x=10*Math.random()-5),parseInt(t.timer)%50===0&&(t.distance.y=10*Math.random()-5);var i=t.distance.x*(e*t.velocity),n=t.distance.y*(e*t.velocity);t.position.x+=i,t.position.y+=n,t.position.x>t.parent.parent.width&&(t.position.x=0),t.position.x<0&&(t.position.x=t.parent.parent.width),t.position.y>t.parent.parent.height&&(t.position.y=0),t.position.y<0&&(t.position.y=t.parent.parent.height),t.angle=Math.atan2(t.distance.y,t.distance.x)*(180/Math.PI)}),this.addListener("render",function(){var e=t.parent.parent.ctx;e.save(),e.translate(t.position.x,t.position.y),e.rotate(t.angle*Math.PI/180),e.translate(-t.dimension.w/2,-t.dimension.h/2),e.beginPath(),e.rect(0,0,t.dimension.w,t.dimension.h),e.fillStyle="red",e.fill(),e.restore()})}function Player(){GameObject(this),this.position={x:0,y:0},this.dimension={w:32,h:32},this.velocity=5,this.moving=!1,this.expanding=!1,this.arming=!1,this.exploding=!1,this.colliding=!1,this.spawning=!1,this.spawningTimer=0,this.dying=!1,this.timer=0,this.moveTo={x:0,y:0},this.rotateTo=0,this.angle=0,this.lives=3,this.bubble={w:0,h:0,vel:1,armed:{w:0,h:0}};var t=this;"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,this.addListener("touchmove",function(e){var i=e.changedTouches;t.moveTo.x=i[0].pageX,t.moveTo.y=i[0].pageY,t.moving=!0,t.exploding||t.arming||(t.exploding=!1,t.arming=!1,t.expanding=!0),e.preventDefault()}),this.addListener("touchstart",function(e){var i=e.changedTouches;t.arming&&(t.moveTo.x=i[0].pageX,t.moveTo.y=i[0].pageY,t.moving=!0),t.expanding=!0}),this.addListener("touchend",function(e){t.bubble.h>32?(t.expanding=!1,this.exploding=!1,t.arming=!0,t.timer=0,t.bubble.armed.w=t.bubble.w,t.bubble.armed.h=t.bubble.h):(t.timer=0,t.expanding=!1,this.exploding=!1,t.arming=!1,t.bubble.armed.w=0,t.bubble.w=0,t.bubble.armed.h=0,t.bubble.h=0)}),this.addListener("update",function(e){if(t.colliding=!1,t.moving){var i=t.moveTo.x-t.position.x,n=t.moveTo.y-t.position.y,o=Math.sqrt(i*i+n*n);o>1?(t.position.x+=i*(e*t.velocity),t.position.y+=n*(e*t.velocity)):t.moving=!1,t.angle=Math.atan2(n,i)*(180/Math.PI)}t.expanding&&t.bubble.h<300&&(t.bubble.w+=32*(e*t.bubble.vel),t.bubble.h+=32*(e*t.bubble.vel)),t.spawning&&(t.spawningTimer+=e*t.velocity*2,console.log(t.spawningTimer)),t.spawningTimer>15&&(t.spawningTimer=0,t.spawning=!1),t.arming&&(t.dimension.w<=64&&(t.dimension.w+=64*(e*t.bubble.vel),t.dimension.h+=64*(e*t.bubble.vel),t.bubble.w+=32*(e*t.bubble.vel),t.bubble.h+=32*(e*t.bubble.vel)),t.timer+=e*t.bubble.vel*2,t.timer>1&&(t.timer=0,t.arming=!1,t.exploding=!0,t.triggerListeners("start-explosion",t))),t.exploding&&(t.dimension.w=32,t.dimension.h=32,t.bubble.w=t.bubble.armed.w,t.bubble.h=t.bubble.armed.h,t.timer+=e*t.bubble.vel*2,t.timer>1&&(t.timer=0,t.exploding=!1,t.bubble.w=0,t.bubble.h=0,t.triggerListeners("end-explosion",t)))}),this.addListener("render",function(){var e=t.parent.parent.ctx;if(e.save(),t.spawning&&(e.globalAlpha=parseInt(10*t.spawningTimer)%2==0?.5:0),e.translate(t.position.x,t.position.y),e.rotate(t.angle*Math.PI/180),e.translate(-t.dimension.w/2,-t.dimension.h/2),e.beginPath(),e.rect(0,0,t.dimension.w,t.dimension.h),e.fillStyle=t.colliding?"red":"white",e.fill(),e.globalAlpha=1,e.restore(),t.expanding&&(e.globalAlpha=.5,e.beginPath(),e.arc(t.position.x,t.position.y,t.bubble.w,0,2*Math.PI),e.fillStyle="#00CCFF",e.fill(),e.globalAlpha=1),t.arming||t.expanding){e.globalCompositeOperation="overlay";for(var i=0;i<10;i++){e.globalAlpha=1,e.beginPath(),e.strokeStyle="#FFFFFF",e.lineWidth=10;var n=t.bubble.w-Math.random()*t.bubble.w;e.arc(t.position.x,t.position.y,n,n/2,n/2+Math.PI),e.stroke(),e.globalAlpha=1}e.globalCompositeOperation="source-over"}t.arming&&(e.globalAlpha=parseInt(10*t.timer)%2==0?.5:0,e.beginPath(),e.arc(t.position.x,t.position.y,t.bubble.w,0,2*Math.PI),e.fillStyle="#00CCFF",e.fill(),e.globalAlpha=1),t.exploding&&(e.globalAlpha=1-t.timer,e.beginPath(),e.arc(t.position.x,t.position.y,t.bubble.w,0,2*Math.PI),e.fillStyle="#FFFFFF",e.fill(),e.globalAlpha=1-5*t.timer,e.beginPath(),e.strokeStyle="#FFFFFF",e.lineWidth=10,e.arc(t.position.x,t.position.y,t.bubble.w+100*t.timer,0,2*Math.PI),e.stroke(),e.globalAlpha=1)})}function Scene(){GameObject(this),this.entities=[],this.parent=null;var t=this;this.addEntity=function(e){e.parent=t,this.entities.push(e)},this.addListener("update",function(e){t.entities.forEach(function(t){t.update(e)})}),this.addListener("render",function(e){t.entities.forEach(function(t){t.render()})})}function Sprite(t){t={id:0,test:3}.merge(t)}function UI(){GameObject(this),this.lives=3,this.score=0,this.kills={number:0,x:0,y:0,show:!1,timer:0,dir:1};var t=this;this.addListener("update",function(e){t.kills.show&&(t.kills.timer+=1.5*e,t.kills.y--,t.kills.timer>1&&(t.kills.show=!1,t.kills.timer=0))}),this.addListener("render",function(){var e=t.parent.parent.ctx;e.fillStyle="white",e.font='bold 24px "04b19"',e.fillText("Score:"+t.score,10,30),e.fillText("Lives:"+t.lives,10,60),t.kills.show&&(e.save(),e.globalAlpha=1-t.kills.timer,e.fillStyle=t.kills.number>9?"yellow":"white",e.font="bold "+(t.kills.number>9?"72px":"48px")+' "04b19"',e.fillText(t.kills.number,t.kills.x,t.kills.y),e.globalAlpha=1,e.restore())})}function glCreateShader(t,e,i){var n,o=t.VERTEX_SHADER,a=e;n=t.createShader(o),t.shaderSource(n,a),t.compileShader(n);var r=n;if(DEBUG&&!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);o=t.FRAGMENT_SHADER,a=i,n=t.createShader(o),t.shaderSource(n,a),t.compileShader(n);var s=n;if(DEBUG&&!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);var h=t.createProgram();if(t.attachShader(h,r),t.attachShader(h,s),t.linkProgram(h),DEBUG&&!t.getProgramParameter(h,t.LINK_STATUS))throw t.getProgramInfoLog(h);t.useProgram(h);var l=t.getAttribLocation(h,"p");return t.enableVertexAttribArray(l),t.vertexAttribPointer(l,2,t.FLOAT,!1,0,0),[h]}function glBindShader(t,e){t.useProgram(e[0])}function glUniformLocation(t,e,i){return e[i]||(e[i]=t.getUniformLocation(e[0],i))}function glCreateTexture(t){var e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}function glSetTexture(t,e,i){t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)}function glBindTexture(t,e,i){return t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),i}function glCreateFBO(t,e,i){var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n);var o=glCreateTexture(t);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),[n,o]}function glBindFBO(t,e){t.bindFramebuffer(t.FRAMEBUFFER,e[0])}function glGetFBOTexture(t){return t[1]}Boid.prototype.render=function(t){var e=2.5*this.radius;t.fillStyle="blue",t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(this.x+Math.cos(this.heading+Math.PI/2)*this.radius,this.y+Math.sin(this.heading+Math.PI/2)*this.radius),t.lineTo(this.x+Math.cos(this.heading+Math.PI)*e,this.y+Math.sin(this.heading+Math.PI)*e),t.lineTo(this.x+Math.cos(this.heading-Math.PI/2)*this.radius,this.y+Math.sin(this.heading-Math.PI/2)*this.radius),t.fill()},Boid.prototype.distance=function(t,e,i){var n=Math.min(this.x,t.x),o=Math.max(this.x,t.x),a=Math.min(this.y,t.y),r=Math.max(this.y,t.y),s=Math.min(o-n,n+e-o),h=Math.min(r-a,a+i-r);return Math.sqrt(s*s+h*h)},Boid.prototype.getNeighbors=function(t){for(var e=t.width,i=t.height,n=[],o=0;o<t.boids.length;o++){var a=t.boids[o];this!==a&&this.distance(a,e,i)<this.vision&&n.push(a)}return n},Boid.wrap=function(t){var e,i;if(2===arguments.length)e=0,i=arguments[1];else{if(3!==arguments.length)throw new Error("wrong number of arguments");e=arguments[1],i=arguments[2]}for(;t>=i;)t-=i-e;for(;t<e;)t+=i-e;return t},Boid.clamp=function(t,e){return Math.min(e,Math.max(-e,t))},Boid.meanAngle=function(){for(var t=0,e=0,i=arguments.length,n=0;n<i;n++)t+=Math.cos(arguments[n]),e+=Math.sin(arguments[n]);return Math.atan2(e/i,t/i)},Boid.prototype.step=function(t){var e=t.width,i=t.height,n=this.getNeighbors(t);if(n.length>0){for(var o=0,a=0,r=0,s=0,h=2*this.radius,l=null,d=0;d<n.length;d++){var c=n[d];o+=Math.cos(c.heading),a+=Math.sin(c.heading),r+=c.x,s+=c.y;var u=this.distance(c,e,i);u<h&&(h=u,l=c)}o/=n.length,a/=n.length,r/=n.length,s/=n.length;var p;if(l)p=Math.atan2(this.y-l.y,this.x-l.x);else{var g=Math.atan2(a,o),m=Math.atan2(s-this.y,r-this.x);p=Boid.meanAngle(g,g,g,m)}var b=Boid.wrap(p-this.heading,-Math.PI,Math.PI);b=Boid.clamp(b,this.radialSpeed),this.heading=Boid.wrap(this.heading+b,-Math.PI,Math.PI)}this.move(t)},Boid.prototype.move=function(t){var e=t.padding,i=t.width,n=t.height;this.x=Boid.wrap(this.x+Math.cos(this.heading)*this.speed,-e,i+2*e),this.y=Boid.wrap(this.y+Math.sin(this.heading)*this.speed,-e,n+2*e)},Boid.prototype=Object.create(GameObject.prototype),Boid.prototype.constructor=Boid,Swarm.prototype=Object.create(GameObject.prototype),Swarm.prototype.constructor=Swarm,Swarm.prototype.createBoid=function(t){for(var e=0;e<(t||1);e++)this.boids.push(new Boid(this))},Swarm.prototype.clear=function(){this.boids=[]},Object.defineProperty(Swarm.prototype,"width",{get:function(){return this.ctx.canvas.width}}),Object.defineProperty(Swarm.prototype,"height",{get:function(){return this.ctx.canvas.height}}),Swarm.step=function(t){var e=t.ctx;e.canvas.width!=window.innerWidth&&(e.canvas.width=window.innerWidth),e.canvas.height!=window.innerHeight&&(e.canvas.height=window.innerHeight),e.fillStyle="white",e.fillRect(0,0,t.width,t.height);for(var i=0;i<t.boids.length;i++)t.boids[i].step(t),t.boids[i].draw(e)},GameObject.prototype.render=function(){this.listeners&&this.listeners.forEach(function(t){"render"==t.type&&t.callback()})},GameObject.prototype.update=function(t){this.listeners&&this.listeners.forEach(function(e){"update"==e.type&&e.callback(t)})},GameObject.prototype.addListener=function(t,e){this.listeners||(this.listeners=[]),this.listeners.push({type:t,callback:e})},GameObject.prototype.triggerListeners=function(t,e){this.listeners||(this.listeners=[]),this.listeners.forEach(function(i){i.type==t&&i.callback(e)})},Game.prototype=Object.create(GameObject.prototype),Game.prototype.constructor=Game,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Glitch.prototype=Object.create(GameObject.prototype),Glitch.prototype.constructor=Glitch,Glitch.prototype.addCollisionTest=function(t,e,i){this.collisionTests||(this.collisionTests=[]),this.collisionTests.push({target:t,type:e,callback:i,collision:!1})},Glitch.prototype.die=function(){this.triggerListeners("die",this)},Object.prototype.merge=function(t){for(var e in t)try{t[e].constructor==Object?this[e]=this.merge(t[e]):this[e]=t[e]}catch(i){this[e]=t[e]}return this},Player.prototype=Object.create(GameObject.prototype),Player.prototype.constructor=Player,Player.prototype.die=function(){console.log("DIE!",this),this.lives--,this.spawning=!0,this.triggerListeners("die",this)},Player.prototype.stopExpanding=function(){this.timer=0,this.expanding=!1,this.moving=!1,this.exploding=!1,this.arming=!1,this.bubble.h=0,this.bubble.w=0},Scene.prototype=Object.create(GameObject.prototype),Scene.prototype.constructor=Scene,UI.prototype=Object.create(GameObject.prototype),UI.prototype.constructor=UI,UI.prototype.displayKills=function(t,e,i){this.kills.number=t,this.kills.show=!0,this.kills.x=e,this.kills.y=i,this.kills.dir=-1,i<200&&(this.kills.dir=1),this.kills.y=i+50*this.kills.dir};var DEBUG=!0,$;!function(){function t(){var t=new Glitch;return t.position={x:10*Math.random()+(0==parseInt(2*Math.random())?$.width-10:0),y:10*Math.random()+(0==parseInt(2*Math.random())?$.height-10:0)},t.addCollisionTest(a,"explosion",function(t,e){e.target.exploding&&(t.die(),o++,n.entities.splice(n.entities.indexOf(t),1))}),t.addCollisionTest(a,"emp",function(t,e){e.target.exploding||e.target.arming||e.target.dying||e.target.spawning||(e.target.die(),e.target.expanding=!1,e.target.stopExpanding())}),t.addCollisionTest(a,"player",function(t,e){e.target.exploding||e.target.arming||e.target.dying||e.target.spawning||(e.target.die(),e.target.colliding=!0)}),t}$=new Game({width:window.innerWidth,height:window.innerHeight/2}),$.init("canvas","webgl");var e=new Scene;e.timer=0,e.helpTexts=[{queue:[1,3],text:"HOW TO PLAY..."},{queue:[4,6],text:"TOUCH TO MOVE"},{queue:[6,8],text:"AND TO ARM THE PULSE"},{queue:[14,18],text:"RELEASE TO TRIGGER IT!"},{queue:[19,22],text:"AFTER RELEASING THE PULSE"},{queue:[22,25],text:"PLACE YOURSELF ABOVE"},{queue:[25,28],text:"THE ENEMIES TO DESTROY THEM"},{queue:[30,35],text:"GOOD LUCK!"}],e.addListener("render",function(){var t=$.ctx,i=(Math.abs(Math.cos(e.timer))/2+2)/3;t.save(),t.translate($.width/2,100),t.scale(i,i),t.fillStyle="white",t.font='bold 120px "04b19"',t.textAlign="center",t.fillText("PULSE",0,40),t.restore(),t.fillStyle="white",t.font='bold 24px "04b19"',t.textAlign="center",t.fillText("TOUCH TO START",$.width/2,$.height-80),e.helpTexts.forEach(function(i){e.timer>i.queue[0]&&e.timer<i.queue[1]&&(t.fillStyle="white",t.font='bold 24px "04b19"',t.textAlign="center",t.fillText(i.text,$.width/2,$.height/2-80))})}),e.addListener("update",function(t){e.parent&&e.parent.keys[32]&&($.activeScene=1,e.timer=0),e.parent&&e.parent.touch&&e.timer>2&&($.activeScene=1,e.timer=0),e.timer+=2*t,5==parseInt(e.timer)&&(e.entities[0].expanding=!0,e.entities[0].moving=!0,e.entities[0].moveTo={x:$.width/2+30,y:$.height/2}),8==parseInt(e.timer)&&(e.entities[0].moving=!0,e.entities[0].moveTo={x:$.width/2-30,y:$.height/2-20}),11==parseInt(e.timer)&&(e.entities[0].moving=!0,e.entities[0].moveTo={x:$.width/2,y:$.height/2}),15==parseInt(e.timer)&&(e.entities[0].expanding=!1,e.entities[0].arming=!0),36==parseInt(e.timer)&&(e.timer=0)});var i=new Player;i.position={x:$.width/2,y:$.height/2},e.addEntity(i),$.addScene(e);var n=new Scene;n.timer=0,n.addListener("update",function(e){0==a.lives&&($.activeScene=0,a.lives=3,a.expanding=!1,a.arming=!1,a.exploding=!1,a.spawning=!1),n.parent&&n.parent.keys[32]&&console.log("Space pressed!"),n.parent&&n.parent.touch,n.timer+=20*e;var i=50-parseInt(n.timer)/10;if(i<0&&(n.timer=0,i=50-parseInt(n.timer)/10),parseInt(n.timer)%i==0){var o=t();n.addEntity(o),console.log("Another glitch")}parseInt(n.timer)%500==0&&console.log("Here comes salvation!")}),n.addListener("spawn-glitches",function(){$.applyBlur()});var o=0,a=new Player;a.position={x:$.width/2,y:$.height/2},n.addEntity(a);for(var r=0;r<50;r++){var s=t();n.addEntity(s)}$.addScene(n);var h=new UI;n.addEntity(h),a.addListener("die",function(t){h.lives=t.lives}),a.addListener("start-explosion",function(t){o=0}),a.addListener("end-explosion",function(t){h.score+=o+o*parseInt(o/2),h.displayKills(o,t.position.x,t.position.y)}),$.activeScene=0}();